<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="R.W. Oldford" />


<title>Saving loon plots</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Saving loon plots</h1>
<h4 class="author">R.W. Oldford</h4>
<h4 class="date">20/04/2020</h4>



<hr />
<div id="interactive-analysis-and-static-plots" class="section level1">
<h1>Interactive analysis and static plots</h1>
<p>When carrying out an interactive analysis, you might want to save some pictures to include in any later report. You might also want to save the state of some interactive plot so that you can pause your analysis, quit R, and later return to your analysis where you left off.</p>
<p>To illustrate how to do this, consider the classic data set <code>iris</code>. Here are three different <strong>linked</strong> plots that might be displayed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(loon)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># First, make sure you always assign a loon plot to a variable</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># at the same time that you create it.  This will give you access</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># to it later.  </span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co"># (NB: If you haven't assigned it, you can later using l_getFromPath(). )</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="co"># </span></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co">#  A histogram, the name for the linkingGroup is arbitrary</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8">h &lt;-<span class="st"> </span><span class="kw">l_hist</span>(iris<span class="op">$</span>Sepal.Length, <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">xlabel =</span> <span class="st">&quot;Sepal length&quot;</span>,</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">            <span class="dt">linkingGroup =</span> <span class="st">&quot;flowers&quot;</span>)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co"># A scatterplot</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">p &lt;-<span class="st"> </span><span class="kw">l_plot</span>(iris<span class="op">$</span>Petal.Width, iris<span class="op">$</span>Petal.Length,  </a>
<a class="sourceLine" id="cb1-13" data-line-number="13">            <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">size =</span> <span class="dv">10</span>,</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">            <span class="dt">xlabel =</span> <span class="st">&quot;Petal Width&quot;</span>, <span class="dt">ylabel =</span> <span class="st">&quot;Petal Length&quot;</span>,</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">            <span class="dt">linkingGroup =</span> <span class="st">&quot;flowers&quot;</span>)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co"># A serial axes plot using the first 4 columns of iris (i.e. no Species info).</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18">sa &lt;-<span class="st"> </span><span class="kw">l_serialaxes</span>(iris[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>],   </a>
<a class="sourceLine" id="cb1-19" data-line-number="19">            <span class="dt">color =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">linkingGroup =</span> <span class="st">&quot;flowers&quot;</span>)</a>
<a class="sourceLine" id="cb1-20" data-line-number="20"><span class="co">#</span></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="co"># A static version of the plot can be easily produced.</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="kw">plot</span>(h)</a></code></pre></div>
<p>That plot will simply just appear (<strong>as it is</strong>) in the processed <code>RMarkdown</code> file.</p>
<p>If you have the <code>grid</code> and <code>gridExtra</code> packages loaded, you could arrange to see several such plots in one place.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">library</span>(grid); <span class="kw">library</span>(gridExtra)</a></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># First get the data stuctures corresponding to the static snapshots</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co"># of the current plots.  Because we want to arrange them, we don't</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co"># draw them at first.</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">plot_h &lt;-<span class="st"> </span><span class="kw">plot</span>(h, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5">plot_p &lt;-<span class="st"> </span><span class="kw">plot</span>(p, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">plot_sa &lt;-<span class="st"> </span><span class="kw">plot</span>(sa, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co"># Now we draw them</span></a>
<a class="sourceLine" id="cb3-8" data-line-number="8"><span class="kw">grid.arrange</span>(plot_h, plot_p, plot_sa, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<div id="when-interaction-is-only-programmatic" class="section level2">
<h2>When interaction is only programmatic</h2>
<p>This works fine when what you want to display has been entirely determined by programming done inside the <code>RMarkdown</code> code. For example, if the colours had been changed programmatically, the linked plots would change and plotting them again would reflect that change.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Change the colour by changing it *programmatically* on the plot</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># </span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">h[<span class="st">&quot;color&quot;</span>] &lt;-<span class="st"> </span>iris<span class="op">$</span>Species  <span class="co"># use species to determine the colours</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">plot_h &lt;-<span class="st"> </span><span class="kw">plot</span>(h, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">plot_p &lt;-<span class="st"> </span><span class="kw">plot</span>(p, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-6" data-line-number="6">plot_sa &lt;-<span class="st"> </span><span class="kw">plot</span>(sa, <span class="dt">draw =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="co"># And draw them again</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="kw">grid.arrange</span>(plot_h, plot_p, plot_sa, <span class="dt">nrow =</span> <span class="dv">1</span>)</a></code></pre></div>
<p>There are a couple of things to note here.</p>
<p>First, the plots had to be redrawn because they are static snapshots reflecting what the interactive plot looked like <strong>at the time</strong> the snapshot was taken using <code>plot()</code>.</p>
<p>Second, all linked plots changed when the colour was only directly changed on the histogram.</p>
<p>Finally, there are numerous <code>states</code> that <strong>can be programmatically accessed and set</strong> on an interactive plot. These states can be found by calling <code>names()</code> on the plot in question.</p>
<ul>
<li>e.g. <code>names(h)</code> returns the state names for the histogram <code>h</code>.</li>
</ul>
<p>Knowing the state names provides the user a programmatic means to access and/or to set their values. The values can be queried at any time, whether they were set programmatically or interactively. For example,</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Accessing values</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="kw">head</span>(sa[<span class="st">&quot;color&quot;</span>])  <span class="co"># will show the current colours of sa</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co"># Note that these colours are expressed as 12 hexadecimal digits </span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># This is what is used in TCL.  To turn them into R's 6 digit hexadecimal </span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co"># (to use in other R static plots, for example) just use hex12tohex6()</span></a>
<a class="sourceLine" id="cb5-6" data-line-number="6"><span class="kw">hex12tohex6</span>(sa[<span class="st">&quot;color&quot;</span>][<span class="dv">1</span><span class="op">:</span><span class="dv">3</span>])</a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="co"># Setting values ... make only specied iris versicolor active</span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8">sa[<span class="st">&quot;active&quot;</span>] &lt;-<span class="st"> </span>iris<span class="op">$</span>Species <span class="op">==</span><span class="st"> &quot;versicolor&quot;</span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="kw">plot</span>(sa)</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"><span class="co"># Setting values ... make everything active</span></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">sa[<span class="st">&quot;active&quot;</span>] &lt;-<span class="st"> </span><span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb5-12" data-line-number="12"><span class="kw">plot</span>(sa)</a></code></pre></div>
<p>A problem with doing things interactively is that any direct manipulation of the plots using the inspector or brushing, panning, zooming, etc. <strong>is not being recorded.</strong></p>
<p>If you want to have the values of states (which were set interactively) to appear later in a report, these values will need to be recorded somewhere first.</p>
<p>It will be necessary to <strong>save the state somehow, either as a snapshot or as data</strong> in a separate file to be recovered later (saving plot states like colours, selections, etc.).</p>
<p>In either case, information must be stored so that an <code>RMarkdown</code> file can read it back in and adjust the plots programmatically.</p>
</div>
<div id="saving-shapshots-for-later-display." class="section level2">
<h2>Saving shapshots for later display.</h2>
<p>When you are doing things interactively, you may just want to save a current version of the plot, effectively a snapshot, to a file. Then, <strong>after</strong> you have completed your analysis you can read those back in.</p>
<p>You would save the current picture in a variety of ways.</p>
<div id="export-from-rstudio" class="section level3">
<h3>Export from RStudio</h3>
<p>Simply <code>plot(p)</code> and select the <code>Export</code> button above the static plot. Choose a file name and location for your plot.</p>
<p>Because <code>plot()</code> actually turns the loon plot into a <code>grid</code> graphic, the picture saves will be close but not necessarily exactly as it appears on screen. Typical differences include font sizes and names.</p>
</div>
<div id="use-l_export" class="section level3">
<h3>Use <code>l_export()</code></h3>
<p>This is a <code>loon</code> function to export a loon plot to a file. On the plus side, what you see is what you get. The loon plot saved to the file will be the same as it appears on the display.</p>
<p>Trouble is, depending on your <code>OS</code>, you might not be able to save the picture as any type of image. For example, <code>pdf</code> images will be available to nearly all OSes, <code>png</code> will not. You do need to specify the file suffix:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">l_export</span>(p, <span class="dt">filename =</span> <span class="st">&quot;myplot_via_l_export.pdf&quot;</span>, <span class="dt">height =</span> <span class="dv">500</span>, <span class="dt">width =</span> <span class="dv">600</span>)</a></code></pre></div>
</div>
<div id="use-rs-png-device" class="section level3">
<h3>Use R’s <code>png()</code> device</h3>
<p>In R, there are a variety of graphics “devices”. These identify where R will draw a static plot. The call <code>dev.cur()</code> will tell you what the current device is.</p>
<p>One such device is <code>png()</code> which allows R plots to be drawn as a <code>png</code> graphic. It would work like this</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="co"># turn the png graphics device on with name of the file</span></a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="kw">png</span>(<span class="dt">file =</span> <span class="st">&quot;myplot_via_R.png&quot;</span>, <span class="dt">width =</span> <span class="dv">600</span>, <span class="dt">height =</span> <span class="dv">500</span>)</a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co"># Draw the static plot</span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="kw">plot</span>(p)</a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co"># Turn the device off/close the file</span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="kw">dev.off</span>()</a></code></pre></div>
</div>
<div id="including-saved-graphics-in-your-report" class="section level3">
<h3>Including saved graphics in your report</h3>
<p>Having saved various snapshots to various files, you can now include them in your Rmarkdown file using the <code>include_graphics()</code> function from <code>knitr</code>.</p>
<p>Of course, this means that the various files mentioned above were previously saved (not created in the markdown file) and so can now be read into your RMarkdown report as follows:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="co"># The one exported from RStudio</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;myplot_via_RStudio.png&quot;</span>)</a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="co"># Followed by the one saved using l_export </span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="co"># (note that background grid is missing)</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;myplot_via_l_export.pdf&quot;</span>)</a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="co"># And finally, the one saved using R's png device</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7">knitr<span class="op">::</span><span class="kw">include_graphics</span>(<span class="st">&quot;myplot_via_R.png&quot;</span>)</a></code></pre></div>
<p>Alternatively, you could use <strong>LaTeX</strong> if you want more control. For example, the following <strong>LaTeX</strong> code would centre the three plots in each column of a tabular lay out:</p>
<!-- \begin{verbatim} -->
<pre><code>\begin{center}
  \begin{tabular} {ccc}
    \includegraphics[height = 0.15\textheight]{myplot_via_RStudio.png} &amp; 
    \includegraphics[height = 0.15\textheight]{myplot_via_l_export.pdf} &amp;
    \includegraphics[height = 0.15\textheight]{myplot_via_R.png} 
    \\
    {\scriptsize The one exported from RStudio} &amp; 
    {\scriptsize The one saved using \code{l\_export}} &amp; 
    {\scriptsize The one saved using R's \code{png} device}
  \end{tabular}
\end{center}</code></pre>
<!-- \end{verbatim} -->
<!-- \begin{center} -->
<!--   \begin{tabular}{ccc} -->
<!--     \includegraphics[height = 0.15\textheight]{./images.savingLoonPlots/myplot_via_RStudio.png} & -->
<!--     \includegraphics[height = 0.15\textheight]{./images.savingLoonPlots/myplot_via_l_export.pdf} & -->
<!--     \includegraphics[height = 0.15\textheight]{./images.savingLoonPlots/myplot_via_R.png}  -->
<!--     \\ -->
<!--     {\scriptsize The one exported from RStudio} &  -->
<!--     {\scriptsize The one saved using \code{l\_export}} &  -->
<!--     {\scriptsize The one saved using R's \code{png} device} -->
<!--   \end{tabular} -->
<!-- \end{center} -->
</div>
</div>
<div id="reconstruct-the-plot-from-saved-states" class="section level2">
<h2>Reconstruct the plot from saved states</h2>
<p><code>loon</code> also provides some functionality to save the <em>current</em> states of a loon plot. As with saving snapshots, this would be done at any time during the interactive analysis. Then later, when it is time to write the report, the saved states of the plot could be read back in and the plot <em>reconstructed programmatically</em> to be displayed in the report using <code>plot()</code> as above.</p>
<p>The use model is</p>
<ol style="list-style-type: decimal">
<li>Use <code>l_saveStates()</code> to save the current states of the loon plot to a file (repeat as often as desirable, saving to a <em>different</em> file each time).</li>
<li>Later, use <code>l_getStates()</code> to recover the saved states from the named file/</li>
<li>Construct a new loon plot of the desired type.</li>
<li>Copy the saved states to the new plot using <code>l_copyStates()</code> (alternatively, assign selected saved states of the new plot using <code>$</code>).</li>
<li>Produce a static picture of the new loon plot using <code>plot()</code> as above.</li>
</ol>
<p>Note that only the first step happens in the interactive part of the analysis. Steps 2 through 5 programmatically recover the plot and its picture for incorporation in a report.</p>
<p>Of course in place of step 5, one could use steps 2 through 4 to restart an interactive analysis where one left off.</p>
<div id="a-simple-example" class="section level3">
<h3>A simple example</h3>
<p>A typical use will be simply recording the plot after some interaction with the display, usually involving linking between two displays, say the scatterplot and histogram above.</p>
<p>We save the states of the plot <code>p</code> in a file as</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">l_saveStates</span>(p, <span class="dt">file =</span> <span class="st">&quot;p_savedStates&quot;</span>)</a></code></pre></div>
<p>Later, when we construct a new plot (perhaps for a report), the states are recovered from file</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">p_savedStates &lt;-<span class="st"> </span><span class="kw">l_getSavedStates</span>(<span class="dt">file =</span> <span class="st">&quot;p_savedStates&quot;</span>)</a></code></pre></div>
<p>A new plot is constructed and the saved states transferred to it.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">new_p &lt;-<span class="st"> </span><span class="kw">l_plot</span>(iris<span class="op">$</span>Petal.Width, iris<span class="op">$</span>Petal.Length)</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw">l_copyStates</span>(<span class="dt">source =</span> p_savedStates, <span class="dt">target =</span> new_p)</a></code></pre></div>
<p>and can be programmatically incorporated into a report as</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">plot</span>(new_p)</a></code></pre></div>
<p>Again, alternatively <code>new_p</code> could simply be a reconstruction so as to continue an interactive analysis from that point.</p>
</div>
<div id="a-more-complex-example" class="section level3">
<h3>A more complex example</h3>
<p>Again, by default, only the following states related to linking are saved</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw">names</span>(p_savedStates)</a></code></pre></div>
<pre><code>## [1] &quot;color&quot;        &quot;active&quot;       &quot;selected&quot;     &quot;linkingKey&quot;   &quot;linkingGroup&quot;</code></pre>
<p><code>[1] &quot;color&quot;        &quot;active&quot;       &quot;selected&quot;     &quot;linkingKey&quot;   &quot;linkingGroup&quot;</code></p>
<p>Sometimes, the interactive analysis will have been more involved. It could, for example, have involved panning and zooming, changing of glyphs, particular choices for labels and titles, and so on.</p>
<p>For example, through direct manipulation of the loon plot and inspector, the scatterplot <code>p</code> might at some point look something like this:</p>
<p>Here, the analyst zoomed in on the species “versicolor”, jittered the locations of the points, and changed some of the glyphs to be large closed triangles. This involves many more states, all of which must be saved to reproduce the plot.</p>
<p>The states to be saved can be named explicitly to be most efficient in storage, providing of course one knows which are the states that need to be saved.</p>
<p>All of the states of a loon plot <code>p</code> are given by <code>names(p)</code>. At the risk of saving more information than necessary, we could choose to save all of the states of <code>p</code>, as in</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw">l_saveStates</span>(p, </a>
<a class="sourceLine" id="cb16-2" data-line-number="2">             <span class="dt">states =</span> <span class="kw">names</span>(p), </a>
<a class="sourceLine" id="cb16-3" data-line-number="3">             <span class="dt">file =</span> <span class="st">&quot;p_focusOnVersicolor&quot;</span>)</a></code></pre></div>
<p>Now all of the states are available when this file is read back in.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">p_focusOnVersicolor &lt;-<span class="st"> </span><span class="kw">l_getSavedStates</span>(<span class="dt">file =</span> <span class="st">&quot;p_focusOnVersicolor&quot;</span>)</a></code></pre></div>
<p>When it comes to transferring the states to a new plot there are many choices. We could go with a large collection of display states (more than the default states but still excluding more “basic” states about panning and zooming for example). To see which states, we add the argument <code>returnNames = TRUE</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw">l_copyStates</span>(<span class="dt">source =</span> p_focusOnVersicolor, </a>
<a class="sourceLine" id="cb18-2" data-line-number="2">             <span class="dt">target =</span> new_p, </a>
<a class="sourceLine" id="cb18-3" data-line-number="3">             <span class="dt">returnNames =</span> <span class="ot">TRUE</span>)</a></code></pre></div>
<p>This excluded “basic” states through the argument <code>excludeBasicStates</code> whose default value is <code>TRUE</code>.</p>
<p>More, or different, states could be excluded by using the argument <code>exclude</code> to list them in a vector. Alternatively, the only states to be transferred could be made explicit by naming them in the value of the argument <code>states</code>.</p>
<p>Because the “basic” states were excluded by default, the new plot now looks like</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw">plot</span>(new_p)</a></code></pre></div>
<p>As can be seen, the glyph sizes and shapes were transferred but not the zooming or the jittering. To ensure we get an exact copy, we need to include all of the states, that is to exclude none of them.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1"><span class="kw">l_copyStates</span>(<span class="dt">source =</span> p_focusOnVersicolor, </a>
<a class="sourceLine" id="cb20-2" data-line-number="2">             <span class="dt">target =</span> new_p, </a>
<a class="sourceLine" id="cb20-3" data-line-number="3">             <span class="dt">excludeBasicStates =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p>Now the <code>new_p</code> should look much like the original interactive plot did when it was saved.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw">plot</span>(new_p)</a></code></pre></div>
<p>which it does.</p>
</div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
